# v1.1 Requirements Archive — Event Photo Gallery

**Milestone:** v1.1 Event Photo Gallery
**Completed:** 2026-02-08
**Result:** 15/15 requirements complete

---

## Gallery Foundation

- [x] **GALL-01**: Route group architecture — `/gallery` with separate root layout, completely isolated from main site's dark theme, Navigation, Footer, and Lenis
  - Phase 1 | Verified: Gallery renders warm theme with zero dark theme artifacts

- [x] **GALL-02**: Supabase backend on Free plan — public Storage bucket for photos, Postgres DB for metadata/likes/comments
  - Phase 1 | Verified: `event-photos` bucket + 4 DB tables operational

- [x] **GALL-03**: Database schema — `events`, `photos`, `photo_likes`, `photo_comments` tables with RLS policies, indexes, and like-count trigger
  - Phase 1 | Verified: RLS, triggers, UNIQUE constraints all functioning

- [x] **GALL-04**: Upload tooling — local Node script using `sharp` to resize photos (thumbnail ~400px + full-size ~1600px) and generate blurhash, then upload to Supabase Storage with metadata INSERT
  - Phase 1 | Verified: 33 photos uploaded for vineyard-women-2026 test event

## Gallery Display

- [x] **GALL-05**: Pinterest-style masonry grid using `react-photo-album` MasonryPhotoAlbum with aspect-ratio-preserving layout
  - Phase 2 | Verified: Responsive masonry with correct aspect ratios

- [x] **GALL-06**: Progressive loading via "Load More" button — 50 photos per batch, progress indicator ("Showing 50 of 347 photos"), Server Component renders first batch
  - Phase 2 | Verified: Server-rendered first batch, client-side pagination working

- [x] **GALL-07**: Photo lightbox via `yet-another-react-lightbox` — full-size image, pinch-to-zoom, swipe navigation, keyboard support
  - Phase 2 | Verified: Zoom, swipe, ESC, backdrop click all functional

- [x] **GALL-08**: Blur placeholders — blurhash strings decoded client-side for instant visual feedback while images load
  - Phase 2 | Verified: CSS z-index approach — canvas behind img, no JS timing issues

## Gallery Social

- [x] **GALL-09**: Anonymous likes — localStorage device ID (`crypto.randomUUID()`), `UNIQUE(photo_id, device_id)` constraint, denormalized `like_count` via Postgres trigger, optimistic UI toggle
  - Phase 3 | UAT passed: Like/unlike works, persists on refresh, no double-likes

- [x] **GALL-10**: Anonymous comments — optional display name (default "Guest"), 500 char limit, DB constraints for length and non-empty
  - Phase 3 | UAT passed: Comments post immediately, Guest default name, char counter works

- [x] **GALL-11**: Spam protection — honeypot field + 2-second time check on comment form, `obscenity` npm package for profanity filter, Postgres trigger rate limit (max 3 comments per device per 5 minutes)
  - Phase 3 | UAT passed: Profanity filter catches words, rate limit enforced server-side

- [x] **GALL-12**: Post-hoc moderation — `is_visible` flag on comments, owner delete via service role key (admin secret in URL or separate endpoint)
  - Phase 3 | Verified: API endpoint at `/api/gallery/moderate` with Bearer token auth

- [x] **GALL-15**: One-tap photo download — download button in lightbox, uses native download attribute
  - Phase 3 | UAT passed: Downloads as JPEG (OffscreenCanvas conversion for webp sources)

## Gallery Design

- [x] **GALL-13**: Warm/cute visual theme — oklch warm palette (cream background, coral accent, warm browns), completely distinct from dark cinematic main site
  - Phase 2 | Verified: Warm palette, no dark theme bleed-through

- [x] **GALL-14**: Mobile-first responsive layout — 2 cols phone, 3 cols tablet, 4-5 cols desktop; large tap targets (min 48px); intuitive for non-tech audience
  - Phase 2 | Verified: Responsive columns, 48px touch targets

---

*Archived: 2026-02-08*
