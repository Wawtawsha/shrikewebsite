---
phase: 03-cinematic-polish-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/LenisProvider.tsx
  - components/PageTransition.tsx
  - app/layout.tsx
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "User experiences smooth inertial scrolling on all pages"
    - "User sees fade/slide transition when navigating between routes"
    - "User with prefers-reduced-motion sees instant navigation with no scroll smoothing"
  artifacts:
    - path: "components/LenisProvider.tsx"
      provides: "Lenis smooth scroll wrapper"
      contains: "lenis"
    - path: "components/PageTransition.tsx"
      provides: "AnimatePresence page transition wrapper"
      contains: "AnimatePresence"
    - path: "app/layout.tsx"
      provides: "Lenis and Motion providers integrated"
      contains: "LenisProvider"
  key_links:
    - from: "app/layout.tsx"
      to: "components/LenisProvider.tsx"
      via: "import and wrap children"
      pattern: "LenisProvider"
    - from: "app/layout.tsx"
      to: "components/PageTransition.tsx"
      via: "wrap page content"
      pattern: "PageTransition"
---

<objective>
Install Lenis and Motion libraries, create smooth scroll provider and page transition wrapper, integrate both into the app layout.

Purpose: Establishes the animation infrastructure (ANIM-01, ANIM-02) that all polish features depend on.
Output: Working smooth scroll site-wide, cinematic fade transitions between routes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-cinematic-polish-performance/03-RESEARCH.md
@app/layout.tsx
@hooks/useReducedMotion.ts
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create LenisProvider</name>
  <files>components/LenisProvider.tsx</files>
  <action>
    Run `npm install lenis@latest motion@latest`

    Create components/LenisProvider.tsx as a "use client" component:
    - Import Lenis from 'lenis' and useEffect, useRef from 'react'
    - Import useReducedMotion from hooks/useReducedMotion
    - Initialize Lenis in useEffect with config: lerp 0.1, duration 1.2, smoothWheel true
    - If reducedMotion is true, do NOT initialize Lenis (native scroll preserved)
    - Set up RAF loop for Lenis.raf(), clean up on unmount (lenis.destroy())
    - Render children pass-through (no extra DOM wrapper)
    - Add the Lenis CSS import if needed: `import 'lenis/dist/lenis.css'` (check if this exists in the package, if not skip it)
  </action>
  <verify>
    `npx next build` passes with no errors. LenisProvider.tsx exists and exports default component.
  </verify>
  <done>Lenis smooth scrolling active on desktop, disabled for reduced-motion users.</done>
</task>

<task type="auto">
  <name>Task 2: Create PageTransition and integrate into layout</name>
  <files>components/PageTransition.tsx, app/layout.tsx</files>
  <action>
    Create components/PageTransition.tsx as a "use client" component:
    - Import AnimatePresence, motion from 'motion/react' (NOT 'framer-motion')
    - Import usePathname from 'next/navigation'
    - Import useReducedMotion from hooks/useReducedMotion
    - Wrap children in AnimatePresence mode="wait"
    - Use motion.div with key={pathname} for route-based transitions
    - Normal motion: initial={{ opacity: 0, y: 20 }}, animate={{ opacity: 1, y: 0 }}, exit={{ opacity: 0, y: -20 }}, transition={{ duration: 0.3, ease: 'easeInOut' }}
    - Reduced motion: initial={{ opacity: 0 }}, animate={{ opacity: 1 }}, exit={{ opacity: 0 }}, transition={{ duration: 0.15 }}
    - ONLY animate opacity and transform (y maps to translateY). No width/height/margin.

    Update app/layout.tsx:
    - Import LenisProvider and PageTransition
    - Wrap the {children} with LenisProvider (outer) and PageTransition (inner)
    - Keep existing layout structure (Navigation, Footer, etc.) intact
    - Do NOT wrap Navigation or Footer in PageTransition — only page content transitions

    Add to app/globals.css:
    - Add `.lenis.lenis-smooth { scroll-behavior: auto; }` if not handled by Lenis CSS
    - Add `html.lenis, html.lenis body { height: auto; }` for Lenis compatibility
  </action>
  <verify>
    `npx next build` passes. Navigate between / and /work — page content fades in/out. Scroll is smooth on desktop.
  </verify>
  <done>Route transitions animate with fade+slide. Lenis smooth scroll active site-wide. Reduced motion users get simple crossfade, no smooth scroll.</done>
</task>

</tasks>

<verification>
- `npx next build` completes with 0 errors
- All routes still render: /, /work, /services, /work/[slug], 404
- Smooth scrolling active on desktop (visible inertia when scrolling)
- Page transitions visible when navigating between routes
- With prefers-reduced-motion: no smooth scroll, simple opacity crossfade only
</verification>

<success_criteria>
- ANIM-01: Lenis smooth scrolling active site-wide
- ANIM-02: Page transitions with AnimatePresence on route changes
- Reduced motion fully respected in both features
- Build passes, no runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-cinematic-polish-performance/03-01-SUMMARY.md`
</output>
