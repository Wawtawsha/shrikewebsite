---
phase: v1.1-02-gallery-display-design
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/gallery/GalleryLightbox.tsx
  - components/gallery/MasonryGrid.tsx
  - app/(gallery)/gallery/GalleryContent.tsx
  - app/(gallery)/gallery.css
autonomous: false

must_haves:
  truths:
    - "Tapping a photo opens a full-screen lightbox with the full-size image"
    - "Lightbox supports pinch-to-zoom on mobile, swipe to navigate between photos, keyboard arrows, and ESC to close"
    - "Gallery uses warm oklch palette with zero dark theme artifacts"
    - "Layout is 2 cols on phone, 3 on tablet, 4-5 on desktop with min 48px tap targets on all interactive elements"
  artifacts:
    - path: "components/gallery/GalleryLightbox.tsx"
      provides: "Lightbox wrapper around yet-another-react-lightbox with Zoom plugin"
      contains: "Lightbox"
    - path: "app/(gallery)/gallery.css"
      provides: "Polished warm theme CSS with responsive spacing and tap target sizes"
      contains: "48px"
  key_links:
    - from: "components/gallery/MasonryGrid.tsx"
      to: "components/gallery/GalleryLightbox.tsx"
      via: "onClick sets lightbox index, GalleryLightbox receives open state + slides"
      pattern: "lightboxIndex|setLightboxIndex"
    - from: "components/gallery/GalleryLightbox.tsx"
      to: "yet-another-react-lightbox"
      via: "Renders Lightbox component with Zoom plugin and slides array"
      pattern: "Lightbox.*open.*close.*slides"
---

<objective>
Add photo lightbox with zoom/swipe navigation, polish the warm visual theme, and ensure mobile-first responsive design with proper tap targets.

Purpose: The masonry grid from Plan 01 displays photos but users cannot view them full-size or navigate between them. This plan adds the lightbox interaction (the primary way users engage with photos) and ensures the visual design is warm, polished, and accessible on mobile devices.

Output: Tapping any photo opens a full-screen lightbox with the full-size image. Lightbox supports pinch-to-zoom, swipe navigation, keyboard arrows, and ESC to close. Gallery CSS is polished with warm palette, proper spacing, and 48px minimum tap targets.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/v1.1-02-gallery-display-design/02-01-SUMMARY.md

# Files from Plan 01 that will be modified:
@components/gallery/MasonryGrid.tsx
@app/(gallery)/gallery/GalleryContent.tsx
@app/(gallery)/gallery.css
@types/gallery.ts
@lib/gallery.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Lightbox integration with zoom and navigation</name>
  <files>
    components/gallery/GalleryLightbox.tsx
    components/gallery/MasonryGrid.tsx
  </files>
  <action>
**1. Create `components/gallery/GalleryLightbox.tsx`** ("use client"):

- Import `Lightbox` from `yet-another-react-lightbox`
- Import `import "yet-another-react-lightbox/styles.css"`
- Import `Zoom` from `yet-another-react-lightbox/plugins/zoom`
- Props: `open: boolean`, `index: number`, `slides: Slide[]`, `onClose: () => void`
- Where `Slide` is `{ src: string, width: number, height: number, alt?: string }`
- Render `<Lightbox>` with:
  - `open={open}`
  - `close={onClose}`
  - `index={index}`
  - `slides={slides}`
  - `plugins={[Zoom]}`
  - `zoom={{ maxZoomPixelRatio: 3 }}` (allow 3x zoom)
  - `animation={{ fade: 300 }}` for smooth open/close transition
  - `carousel={{ finite: false }}` to allow looping through photos
  - `controller={{ closeOnBackdropClick: true }}` so tapping outside closes it
- The lightbox CSS from yet-another-react-lightbox handles all the swipe/pinch/keyboard behavior automatically. Do NOT write custom gesture handlers.

**2. Update `components/gallery/MasonryGrid.tsx`** to wire up the lightbox:

- Add state: `const [lightboxIndex, setLightboxIndex] = useState(-1)` (-1 means closed)
- On the MasonryPhotoAlbum `onClick` handler: `({ index }) => setLightboxIndex(index)`
- Build the slides array from the current `photos` state: map each photo to `{ src: getStorageUrl(photo.storage_path), width: photo.width, height: photo.height }`. Note: this uses `storage_path` (full-size image) not `thumb_path` (thumbnail used in grid).
- Render `<GalleryLightbox>` at the bottom of the component:
  ```tsx
  <GalleryLightbox
    open={lightboxIndex >= 0}
    index={lightboxIndex}
    slides={slides}
    onClose={() => setLightboxIndex(-1)}
  />
  ```
- Important: As the user loads more photos via Load More, the `slides` array grows. The lightbox should include ALL currently loaded photos, not just the initial batch. This works naturally since `slides` is derived from the `photos` state which includes all loaded photos.
- Add cursor pointer to photos in the grid so users know they're clickable. Use the render.extras or render.wrapper to add `cursor-pointer` to photo containers. Or add `style={{ cursor: "pointer" }}` to the container in the render.image override from Plan 01.
  </action>
  <verify>
- `npm run build` passes with no errors
- Click a photo in the grid -- lightbox opens showing the full-size image
- Swipe left/right in lightbox to navigate between photos
- Press ESC or click backdrop to close
- Press arrow keys to navigate
- Pinch-to-zoom works on mobile (test with Chrome DevTools device emulation touch)
- After loading more photos via Load More, clicking a newly loaded photo opens lightbox correctly
  </verify>
  <done>
- Lightbox opens on photo tap with full-size image (not thumbnail)
- Zoom plugin active: pinch-to-zoom on touch, scroll-to-zoom on desktop
- Swipe navigation between photos
- Keyboard support: left/right arrows to navigate, ESC to close
- Tap outside / click backdrop closes lightbox
- Lightbox includes all currently loaded photos (grows with Load More)
  </done>
</task>

<task type="auto">
  <name>Task 2: Warm theme polish and mobile-first responsive design</name>
  <files>
    app/(gallery)/gallery.css
    app/(gallery)/gallery/GalleryContent.tsx
  </files>
  <action>
**1. Polish `app/(gallery)/gallery.css`** for the warm/cute visual theme:

- Ensure the warm oklch palette from Phase 1 is complete and applied. Add any missing tokens:
  - `--color-accent-soft`: a lighter version of coral for subtle backgrounds (`oklch(0.92 0.06 25)`)
  - Add `--color-heart`: specific red/pink for the like button (Phase 3 will use it) (`oklch(0.6 0.22 15)`)
- Override yet-another-react-lightbox default styles to match the warm theme:
  ```css
  .yarl__root {
    --yarl__color_backdrop: rgba(30, 20, 15, 0.92);
  }
  ```
- Override react-photo-album styles if needed for rounded corners on photos:
  ```css
  .react-photo-album--photo {
    border-radius: 8px;
    overflow: hidden;
  }
  ```
- Ensure all interactive elements have minimum 48px tap targets. Add:
  ```css
  .gallery-tap-target {
    min-height: 48px;
    min-width: 48px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  ```
- Add responsive spacing utilities for the gallery:
  ```css
  .gallery-container {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 16px;
  }
  @media (min-width: 768px) {
    .gallery-container {
      padding: 0 24px;
    }
  }
  @media (min-width: 1024px) {
    .gallery-container {
      padding: 0 32px;
    }
  }
  ```
- Style the gallery header (event title area) with warm aesthetics: larger text on desktop, comfortable spacing, and a subtle bottom border or decorative element.
- Verify NO dark theme artifacts: search for any hardcoded dark colors (oklch values with lightness < 0.3 in background contexts, white text on dark backgrounds). The gallery should feel cream/coral/warm brown, never dark/cinematic.

**2. Polish `app/(gallery)/gallery/GalleryContent.tsx`** for responsive layout:

- Apply `gallery-container` class for proper padding/max-width
- Header section: event title (`text-2xl md:text-4xl font-bold`), event date (formatted with `toLocaleDateString` in a readable format like "March 15, 2026"), photo count badge
- Add a warm background texture or subtle gradient to the header area if it looks too flat (keep it subtle -- a slightly different cream shade, not a pattern image)
- Ensure the Load More button is centered and has generous padding on mobile
- The "no event" and "event not found" error states should also use the warm theme -- friendly messaging like "Hmm, we couldn't find that gallery" rather than technical error text
- Add reduced motion support: import `useReducedMotion` hook. If reduced motion is preferred, disable any entrance animations on the grid photos (from the render.image wrapper in MasonryGrid). Pass a prop to MasonryGrid for this.
  </action>
  <verify>
- `npm run build` passes
- Gallery page renders with warm cream background, coral accents, warm brown text
- No dark theme colors visible anywhere on the gallery page
- On mobile (375px width): 2 column grid, all buttons have 48px+ tap targets, comfortable padding
- On tablet (768px): 3 column grid, increased padding
- On desktop (1440px): 4-5 column grid, centered with max-width, generous whitespace
- Lightbox backdrop uses warm dark tone, not harsh black
- Error states ("no event", "not found") render in warm theme with friendly text
- Load More button is large, centered, and easy to tap on mobile
  </verify>
  <done>
- Gallery uses warm oklch palette throughout: cream background, coral accents, warm browns
- Zero dark theme artifacts on any gallery page
- Mobile-first responsive: 2/3/4-5 columns at phone/tablet/desktop breakpoints
- All interactive elements (Load More, photo tap targets) have minimum 48px touch area
- Lightbox styled consistently with warm theme
- Reduced motion respected
- Error states are friendly and warm-themed
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete gallery display: masonry grid with real photos, Load More pagination, lightbox with zoom/swipe, warm visual theme, mobile-responsive layout</what-built>
  <how-to-verify>
1. Open http://localhost:3000/gallery?event={your-test-event-slug} on desktop
2. Verify: Photos render in a 4-5 column masonry grid with warm cream background and coral accents
3. Verify: Blurhash placeholders show briefly before images load (throttle network to Slow 3G in DevTools to see this clearly)
4. Verify: "Showing X of Y photos" progress indicator is visible below the grid
5. If >50 photos: click "See more photos" button, verify more photos load and count updates
6. Click any photo: lightbox opens with full-size image. Use arrow keys to navigate. Press ESC to close.
7. Open Chrome DevTools, toggle device toolbar, select iPhone 14 (390px width)
8. Verify: Grid shows 2 columns, Load More button is full-width and easy to tap
9. Tap a photo: lightbox opens. Try swiping left/right to navigate.
10. Navigate to http://localhost:3000/ -- verify main dark site is completely unaffected
11. Navigate to http://localhost:3000/gallery -- verify friendly "no event" message
12. Navigate to http://localhost:3000/gallery?event=fake-slug -- verify friendly "not found" message
  </how-to-verify>
  <resume-signal>Type "approved" if the gallery looks and works correctly, or describe any visual/functional issues</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. `/gallery?event={slug}` renders masonry grid with real photos from Supabase
3. Photos have correct aspect ratios (no stretching or cropping in the grid)
4. Blurhash placeholders visible on slow connections
5. Load More button works, progress indicator updates
6. Lightbox opens on photo tap with full-size image
7. Lightbox: pinch-to-zoom, swipe navigate, keyboard arrows, ESC close all work
8. Gallery uses warm oklch palette everywhere, zero dark theme bleeding
9. Mobile: 2 columns, 48px+ tap targets, comfortable spacing
10. Tablet: 3 columns
11. Desktop: 4-5 columns, centered max-width 1400px
12. Main site routes unaffected
13. Reduced motion respected (no animations when preference set)
</verification>

<success_criteria>
- Lightbox provides full-size photo viewing with zoom, swipe, and keyboard navigation
- Gallery visual design is warm/cute: cream, coral, warm brown -- completely distinct from dark main site
- Mobile-first responsive design with correct column counts and 48px+ tap targets
- Human verification confirms the gallery looks and feels right for the target audience (women 30-60, not tech-savvy)
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-02-gallery-display-design/02-02-SUMMARY.md`
</output>
